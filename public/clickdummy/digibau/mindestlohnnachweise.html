<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mindestlohn Nachweise Mockup</title>
    <style>
        body { margin:0; font-family:Arial,sans-serif; }
        .view { display:none; padding:20px; box-sizing:border-box; }
        .view.active { display:block; }
        #list-view table { width:100%; border-collapse: collapse; }
        #list-view th, #list-view td { padding:10px; border:1px solid #ddd; text-align:left; }
        tr.clickable { cursor:pointer; }
        tr.clickable:hover { background:#f9f9f9; }
        .back-btn { margin-bottom:20px; }
        .tabs { display:flex; border-bottom:1px solid #ccc; margin-bottom:10px; }
        .tab { padding:10px 20px; cursor:pointer; }
        .tab.active { border-bottom:2px solid #007bff; font-weight:bold; }
        .tab-content { display:none; }
        .tab-content.active { display:block; }
        button { cursor:pointer; }
        /* Details Form Layout */
        #details form { display:flex; flex-direction:column; max-width:400px; }
        #details label { margin-top:15px; font-weight:bold; }
        #details input { width:100%; padding:8px; margin-top:5px; box-sizing:border-box; }
        #details button { align-self:flex-start; margin-top:20px; padding:10px 20px; }

        .modal-overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
        .modal { background:#fff; padding:20px; border-radius:8px; width:400px; max-width:90%; }
        .modal h3 { margin-top:0; }
        .modal form { display:flex; flex-direction:column; }
        .modal label { margin-top:10px; font-weight:bold; }
        .modal input { width:100%; padding:8px; margin-top:5px; box-sizing:border-box; }
        .modal-buttons { margin-top:20px; display:flex; justify-content:flex-end; }
        .modal-buttons button { margin-left:10px; padding:6px 12px; }

        table.inner { width:100%; border-collapse: collapse; margin-bottom:10px; }
        table.inner th, table.inner td { padding:8px; border:1px solid #ddd; }
        .action-btn { margin-right:5px; }
        #add-emp-btn, #export-btn { margin-bottom:10px; padding:8px 12px; }
    </style>
</head>
<body>
<!-- Projektliste Vollbild -->
<div id="list-view" class="view active">
    <h1>Projekte</h1>
    <input type="text" id="project-search" placeholder="Projekte suchen..." style="width:100%;padding:8px;margin-bottom:15px;box-sizing:border-box;">
    <table>
        <thead>
        <tr><th>Nr.</th><th>Name</th><th>Ort</th><th>Baubeginn</th><th>Bauende</th></thead>
        <tbody id="project-table-body"></tbody>
    </table>
</div>

<!-- Projektdetail-Seite -->
<div id="project-view" class="view">
    <button class="back-btn" id="back-btn">◀ Zurück zu Projekten</button>
    <h1 id="project-title">Projektübersicht</h1>
    <div class="tabs">
        <div class="tab active" data-tab="details">Details</div>
        <div class="tab" data-tab="employees">Mitarbeiter</div>
        <div class="tab" data-tab="nachweise">Mindestlohn-Nachweise</div>
    </div>
    <div id="details" class="tab-content active">
        <form id="project-form">
            <label for="proj-number">Projektnummer</label>
            <input type="text" id="proj-number">
            <label for="proj-name">Projektname</label>
            <input type="text" id="proj-name">
            <label for="proj-location">Ausführungsort</label>
            <input type="text" id="proj-location">
            <label for="proj-start">Baubeginn (Jahr)</label>
            <input type="number" id="proj-start" min="2000" max="2100" step="1">
            <label for="proj-end">Bauende (Jahr)</label>
            <input type="number" id="proj-end" min="2000" max="2100" step="1">
            <button type="submit" id="save-btn">Speichern</button>
        </form>
    </div>
    <div id="employees" class="tab-content">
        <button id="add-emp-btn">Mitarbeiter hinzufügen</button>
        <table class="inner">
            <thead><tr><th>Vorname</th><th>Nachname</th><th>Wohnort</th><th>Geburtstag</th><th>Zeitraum</th><th>Aktion</th></tr></thead>
            <tbody id="employees-body"></tbody>
        </table>
    </div>
    <div id="nachweise" class="tab-content">
        <button id="export-btn">Export Nachweise (CSV)</button>
        <table class="inner">
            <thead><tr><th>Dateiname</th><th>Upload-Datum</th><th>Aktion</th></tr></thead>
            <tbody id="documents-body"></tbody>
        </table>
        <input type="file" id="file-input">
    </div>
</div>

<!-- Modal für Mitarbeiter-Erfassung und -Bearbeitung -->
<div id="emp-modal" class="modal-overlay">
    <div class="modal">
        <h3 id="emp-modal-title">Mitarbeiter hinzufügen</h3>
        <form id="employee-form">
            <label for="emp-first">Vorname</label>
            <input type="text" id="emp-first">
            <label for="emp-last">Nachname</label>
            <input type="text" id="emp-last">
            <label for="emp-location">Wohnort</label>
            <input type="text" id="emp-location">
            <label for="emp-dob">Geburtstag</label>
            <input type="date" id="emp-dob">
            <label for="emp-period">Zeitraum</label>
            <input type="text" id="emp-period" placeholder="z.B. 2025 - 2026">
            <div class="modal-buttons">
                <button type="button" id="emp-cancel">Abbrechen</button>
                <button type="submit">Speichern</button>
            </div>
        </form>
    </div>
</div>

<script>
    const projects = [
        { id:1, number:'045873', name:'DigiBau', location:'Wiesbaden', start:'2025', end:'2025', employees:[{first:'Anna',last:'Müller',location:'Wiesbaden',dob:'1985-06-15',period:'2025'}], docs:[{file:'ml_DigiBau_01.pdf',date:'2025-02-10'}] },
        { id:2, number:'045874', name:'Projekt Beta', location:'Frankfurt', start:'2026', end:'2026', employees:[{first:'Peter',last:'Schmidt',location:'Frankfurt',dob:'1990-04-20',period:'2026'}], docs:[{file:'ml_Beta_01.pdf',date:'2025-03-20'}] }
    ];
    let currentProject = null;
    let editingEmployeeIndex = null;

    // Elemente
    const listView = document.getElementById('list-view');
    const projectView = document.getElementById('project-view');
    const backBtn = document.getElementById('back-btn');
    const tableBody = document.getElementById('project-table-body');
    const searchEl = document.getElementById('project-search');
    const titleEl = document.getElementById('project-title');
    const form = document.getElementById('project-form');
    const addEmpBtn = document.getElementById('add-emp-btn');
    const empModal = document.getElementById('emp-modal');
    const employeeForm = document.getElementById('employee-form');
    const employeesBody = document.getElementById('employees-body');
    const documentsBody = document.getElementById('documents-body');
    const empCancel = document.getElementById('emp-cancel');
    const empModalTitle = document.getElementById('emp-modal-title');
    const exportBtn = document.getElementById('export-btn');

    // Projekttabelle
    function renderProjectTable(filter=''){
        tableBody.innerHTML = '';
        projects.filter(p => p.name.toLowerCase().includes(filter.toLowerCase()) || p.number.includes(filter))
            .forEach(p => {
                const tr = document.createElement('tr'); tr.classList.add('clickable'); tr.dataset.id = p.id;
                tr.innerHTML = `<td>${p.number}</td><td>${p.name}</td><td>${p.location}</td><td>${p.start}</td><td>${p.end}</td>`;
                tr.addEventListener('click', () => openProjectView(p.id));
                tableBody.appendChild(tr);
            });
    }

    // Projektansicht öffnen
    function openProjectView(id){
        currentProject = projects.find(p => p.id === id);
        listView.classList.remove('active'); projectView.classList.add('active');
        populateDetails(); renderEmployees(); renderDocuments();
        titleEl.textContent = `${currentProject.number} – ${currentProject.name}`;
    }

    // Details füllen
    function populateDetails(){
        document.getElementById('proj-number').value = currentProject.number;
        document.getElementById('proj-name').value = currentProject.name;
        document.getElementById('proj-location').value = currentProject.location;
        document.getElementById('proj-start').value = currentProject.start;
        document.getElementById('proj-end').value = currentProject.end;
    }
    form.addEventListener('submit', e => {
        e.preventDefault();
        currentProject.number = document.getElementById('proj-number').value;
        currentProject.name = document.getElementById('proj-name').value;
        currentProject.location = document.getElementById('proj-location').value;
        currentProject.start = document.getElementById('proj-start').value;
        currentProject.end = document.getElementById('proj-end').value;
        renderProjectTable(searchEl.value);
        titleEl.textContent = `${currentProject.number} – ${currentProject.name}`;
    });

    // Mitarbeiter hinzufügen / bearbeiten
    addEmpBtn.addEventListener('click', () => {
        editingEmployeeIndex = null;
        empModalTitle.textContent = 'Mitarbeiter hinzufügen';
        employeeForm.reset();
        empModal.style.display = 'flex';
    });
    empCancel.addEventListener('click', () => empModal.style.display = 'none');
    employeeForm.addEventListener('submit', e => {
        e.preventDefault();
        const first = document.getElementById('emp-first').value;
        const last = document.getElementById('emp-last').value;
        const loc = document.getElementById('emp-location').value;
        const dob = document.getElementById('emp-dob').value;
        const period = document.getElementById('emp-period').value;
        const newEmp = { first, last, location: loc, dob, period };
        if (editingEmployeeIndex !== null) {
            currentProject.employees[editingEmployeeIndex] = newEmp;
        } else {
            currentProject.employees.push(newEmp);
        }
        empModal.style.display = 'none'; renderEmployees();
    });
    window.editEmployee = function(idx) {
        editingEmployeeIndex = idx;
        const emp = currentProject.employees[idx];
        empModalTitle.textContent = 'Mitarbeiter bearbeiten';
        document.getElementById('emp-first').value = emp.first;
        document.getElementById('emp-last').value = emp.last;
        document.getElementById('emp-location').value = emp.location;
        document.getElementById('emp-dob').value = emp.dob;
        document.getElementById('emp-period').value = emp.period;
        empModal.style.display = 'flex';
    };
    window.deleteEmployee = function(idx) {
        if (confirm('Mitarbeiter wirklich löschen?')) {
            currentProject.employees.splice(idx, 1);
            renderEmployees();
        }
    };

    function renderEmployees(){
        employeesBody.innerHTML = '';
        currentProject.employees.forEach((emp, idx) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${emp.first}</td><td>${emp.last}</td><td>${emp.location}</td><td>${emp.dob}</td><td>${emp.period}</td><td><button class="action-btn" onclick="editEmployee(${idx})">Bearbeiten</button><button class="action-btn" onclick="deleteEmployee(${idx})">Löschen</button></td>`;
            employeesBody.appendChild(tr);
        });
    }

    // Nachweise
    document.getElementById('file-input').addEventListener('change', e => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = () => {
                currentProject.docs.push({ file: file.name, date: new Date().toISOString().split('T')[0] });
                renderDocuments();
            };
            reader.readAsText(file);
        }
    });
    function renderDocuments(){
        documentsBody.innerHTML = '';
        currentProject.docs.forEach(d => {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${d.file}</td><td>${d.date}</td><td><button>Herunterladen</button></td>`;
            documentsBody.appendChild(tr);
        });
    }

    // Export Nachweise
    exportBtn.addEventListener('click', () => {
        const csv = 'Dateiname,Upload-Datum\n' + currentProject.docs.map(d => `${d.file},${d.date}`).join('\n');
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `Nachweise_${currentProject.number}.csv`;
        a.click();
        URL.revokeObjectURL(url);
    });

    // Navigation
    document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', () => {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
            tab.classList.add('active');
            document.getElementById(tab.dataset.tab).classList.add('active');
        });
    });
    backBtn.addEventListener('click', () => { projectView.classList.remove('active'); listView.classList.add('active'); });
    searchEl.addEventListener('input', () => renderProjectTable(searchEl.value));

    // Initial
    renderProjectTable();
</script>
</body>
</html>
